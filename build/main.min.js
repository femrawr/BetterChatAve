(()=>{"use strict";const e={listeners:{},on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},remove(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(e=>e!==t))},emit(e,t){this.listeners[e]&&this.listeners[e].forEach(e=>e(t))}},t="box",n="button",s="list",i="slider",o="toggle",a={Left:"left",Right:"right"},d={Modules:"modules",Settings:"settings"},r={main:null,left:null,right:null,notifs:null,content:{},tab:d.Modules,notifsAllowed:!0,createMain(t){this.main=document.createElement("div"),Object.assign(this.main.style,{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"900px",height:"600px",background:"#1a1a1a",overflow:"hidden",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.8)",display:"flex",flexDirection:"column",zIndex:"10000"});const n=document.createElement("div");this._dragify(n),Object.assign(n.style,{height:"30px",background:"#2a2a2a",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0 15px",borderBottom:"1px solid #333",userSelect:"none"});const s=document.createElement("div");s.textContent=t||"Better Chat Ave",Object.assign(s.style,{color:"#ffffff",fontSize:"14px",fontWeight:"600"});const i=document.createElement("div");Object.assign(i.style,{display:"flex",gap:"8px"});const o=this._createControl("#ffbd2e",()=>{this.main.style.display="none"}),a=this._createControl("#ff5f56",()=>{e.emit("exit")}),r=document.createElement("div");Object.assign(r.style,{background:"#0a0a0a",display:"flex",gap:"10px",padding:"5px 15px"});const l=document.createElement("div");Object.assign(l.style,{flex:"1",display:"flex",gap:"15px",padding:"5px 15px 15px 15px",background:"#0a0a0a",overflow:"hidden"}),this.left=document.createElement("div"),Object.assign(this.left.style,{flex:"1",background:"#1a1a1a",padding:"15px",overflowY:"auto",border:"1px solid #2a2a2a"}),this.right=document.createElement("div"),Object.assign(this.right.style,{flex:"1",background:"#1a1a1a",padding:"15px",overflowY:"auto",border:"1px solid #2a2a2a"}),this.notifs=document.createElement("div"),Object.assign(this.notifs.style,{position:"fixed",top:"20px",right:"20px",display:"flex",flexDirection:"column",gap:"10px",zIndex:"10000",pointerEvents:"none"}),Object.values(d).forEach(e=>{const t=document.createElement("button");t.textContent=e,Object.assign(t.style,{padding:"3px 12px",background:this.tab===e?"#1967d2":"#2a2a2a",color:this.tab===e?"#fff":"#999",border:"none",cursor:"pointer",fontSize:"11px",fontWeight:"500",transition:"all 0.2s"}),t.addEventListener("mouseenter",()=>{this.tab!==e&&(t.style.background="#333")}),t.addEventListener("mouseleave",()=>{this.tab!==e&&(t.style.background="#2a2a2a")}),t.addEventListener("click",()=>{this.tab=e,Object.values(d).forEach(t=>{const n=r.children[Object.values(d).indexOf(t)];t===e?(n.style.background="#1967d2",n.style.color="#fff"):(n.style.background="#2a2a2a",n.style.color="#999")}),this._renderTab()}),r.appendChild(t)}),document.addEventListener("keydown",e=>{if("Insert"!==e.key)return;const t=this.main.style.display;this.main.style.display="none"===t?"flex":"none"}),i.appendChild(o),i.appendChild(a),n.appendChild(s),n.appendChild(i),l.appendChild(this.left),l.appendChild(this.right),this.main.appendChild(n),this.main.appendChild(r),this.main.appendChild(l),this._renderTab(),document.body.appendChild(this.main),document.body.appendChild(this.notifs),window.bca.artifacts.push(this.main),window.bca.artifacts.push(this.notifs)},sendNotif(t,n=0){if(!this.notifsAllowed)return;const s=document.createElement("div");Object.assign(s.style,{background:"#1a1a1a",border:"1px solid #2a2a2a",padding:"12px 16px",minWidth:"250px",maxWidth:"350px",color:"#ddd",fontSize:"13px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.5)",cursor:"pointer",pointerEvents:"auto",transform:"translateX(400px)",transition:"transform 0.3s ease",borderLeft:"3px solid #1967d2"});const i=document.createElement("div");i.textContent=t,i.style.lineHeight="1.4",s.appendChild(i),this.notifs.appendChild(s),setTimeout(()=>{s.style.transform="translateX(0)"},5),s.addEventListener("click",()=>{s.style.transform="translateX(400px)",e.emit("notif.clicked",{text:t}),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},300)}),0!==n&&setTimeout(()=>{s.parentNode&&(s.style.transform="translateX(400px)",setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},300))},1e3*n)},_renderTab(){this.left.innerHTML="",this.right.innerHTML="",this.content[this.tab]||(this.content[this.tab]={}),Object.values(a).forEach(e=>{Object.hasOwn(this.content[this.tab],e)||(this.content[this.tab][e]=[])});const e=this.content[this.tab];e.left.forEach(e=>this.left.appendChild(e)),e.right.forEach(e=>this.right.appendChild(e))},_createControl(e,t){const n=document.createElement("div");return Object.assign(n.style,{width:"12px",height:"12px",background:e,borderRadius:"50%",cursor:"pointer",transition:"opacity 0.2s"}),n.addEventListener("mouseenter",()=>{n.style.opacity="0.7"}),n.addEventListener("mouseleave",()=>{n.style.opacity="1"}),n.addEventListener("click",t),n},_dragify(e){let t,n,s,i,o=!1;e.addEventListener("mousedown",e=>{o=!0;const t=this.main.getBoundingClientRect();s=e.clientX-t.left,i=e.clientY-t.top,Object.assign(this.main.style,{transform:"none",left:t.left+"px",top:t.top+"px"})}),document.addEventListener("mousemove",e=>{o&&(e.preventDefault(),t=e.clientX-s,n=e.clientY-i,Object.assign(this.main.style,{left:t+"px",top:n+"px"}))}),document.addEventListener("mouseup",()=>{o=!1})}},l={onXHR:[],_hooked:{},hookXHR(e){const t=this;this._hooked.xhrOpen=XMLHttpRequest.prototype.open,this._hooked.xhrSend=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.open=function(...e){return this._main=e[1].includes("chat_process.php"),this._priv=e[1].includes("private_process.php"),this._hook=this._main||this._priv,t._hooked.xhrOpen.apply(this,e)},XMLHttpRequest.prototype.send=function(...e){if(!this._hook)return t._hooked.xhrSend.apply(this,e);for(const n of t.onXHR)n.call(this,e);return t._hooked.xhrSend.apply(this,e)}},unhookXHR(){XMLHttpRequest.prototype.open=this._hooked.xhrOpen,delete this._hooked.xhrOpen,XMLHttpRequest.prototype.send=this._hooked.xhrSend,delete this._hooked.xhrSend,this.onXHR=[]}},c={save:{},get(){const e=localStorage.getItem("bca");return JSON.parse(e)||null},set(){localStorage.setItem("bca",JSON.stringify(this.save))},update(e,t){const n=this.get()||{};n[e]=t,this.save=n,this.set()}};class h{constructor(){this.side=a.Left,this.tab=d.Modules}setSide(e){return this.side=e,this}setTab(e){return this.tab=e,this}_buildInto(e){r.content[this.tab]||(r.content[this.tab]={}),Object.values(a).forEach(e=>{Object.hasOwn(r.content[this.tab],e)||(r.content[this.tab][e]=[])}),r.content[this.tab][this.side].push(e),r.tab===this.tab&&r._renderTab()}}class p extends h{constructor(){super(),this.text="text",this.placeholder="",this.val="",this.info=""}setText(e){return this.text=e,this}setGhost(e){return this.placeholder=e,this}setVal(e){return this.val=e,this}setInfo(e){return this.info=e,this}build(){const t=document.createElement("div");Object.assign(t.style,{marginBottom:"10px"});const n=document.createElement("div");Object.assign(n.style,{padding:"12px",background:"#0f0f0f",border:"1px solid #2a2a2a",cursor:"pointer",userSelect:"none"});const s=document.createElement("div");s.textContent=this.text,Object.assign(s.style,{color:"#ddd",fontSize:"13px",marginBottom:"8px"});const i=document.createElement("input");Object.assign(i,{type:"text",value:this.val,placeholder:this.placeholder,spellcheck:!1}),Object.assign(i.style,{width:"100%",padding:"8px",background:"#2a2a2a",color:"#ddd",border:"1px solid #333",fontSize:"13px",outline:"none",boxSizing:"border-box"});const o=document.createElement("div");o.textContent=this.info,Object.assign(o.style,{padding:"12px",background:"#0a0a0a",border:"1px solid #2a2a2a",borderTop:"none",color:"#999",fontSize:"12px",lineHeight:"1.5",display:"none"}),i.addEventListener("change",t=>{e.emit("module.change",{name:this.text,val:t.target.value})});let a=!1;return n.addEventListener("contextmenu",e=>{e.preventDefault(),a=!a,o.style.display=a?"block":"none",n.style.background=a?"#151515":"#0f0f0f"}),n.appendChild(s),n.appendChild(i),t.appendChild(n),t.appendChild(o),this._buildInto(t),this}}class u extends h{constructor(){super(),this.text="text",this.binded=!1,this.bind="none",this.info="",this._listening=!1,this._held=new Set}setText(e){return this.text=e,this}setBinded(){return this.binded=!0,this}setBind(e){return this.bind=e,this}setInfo(e){return this.info=e,this}build(){const t=document.createElement("div");Object.assign(t.style,{marginBottom:"10px",position:"relative"});const n=document.createElement("button");n.textContent=this.text,Object.assign(n.style,{width:"100%",padding:"12px",background:"#1967d2",color:"white",border:"none",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"background 0.15s"});const s=document.createElement("div");s.textContent=this.info,Object.assign(s.style,{padding:"12px",background:"#0a0a0a",border:"1px solid #2a2a2a",borderTop:"none",color:"#999",fontSize:"12px",lineHeight:"1.5",display:"none"});let i=!1;if(n.addEventListener("contextmenu",e=>{e.preventDefault(),i=!i,s.style.display=i?"block":"none",n.style.background=i?"#1558b0":"#1967d2"}),n.addEventListener("mousedown",()=>{n.style.background="#175fc4"}),n.addEventListener("mouseup",()=>{n.style.background=i?"#1558b0":"#1967d2"}),n.addEventListener("mouseleave",()=>{n.style.background=i?"#1558b0":"#1967d2"}),n.addEventListener("click",()=>{e.emit("module.call",{name:this.text,bind:this.bind,call:!0})}),this.binded){const s=document.createElement("div");Object.assign(s.style,{position:"absolute",top:"-6px",right:"-4px",padding:"4px 8px",background:"#0a0a0a",fontSize:"12px",cursor:"pointer",userSelect:"none",minWidth:"60px",textAlign:"center",zIndex:"1",fontWeight:"600"}),this._updateStyle(s),s.addEventListener("click",e=>{e.stopPropagation(),this._listening||(this._listening=!0,this._held.clear(),this._updateStyle(s))}),document.addEventListener("keydown",e=>{if(!this._listening&&"none"!==this.bind){if(this._getHeldKeys(e)!==this.bind)return;return void n.click()}if(this._listening){e.preventDefault();const t=this._normalizeKey(e.key);this._held.add(t);const n=Array.from(this._held);s.textContent=`[${n.join(" + ")}]`,s.style.color="#1967d2"}}),document.addEventListener("keyup",t=>{if(!this._listening)return;t.preventDefault();const n=this._normalizeKey(t.key);if(this._held.delete(n),0===this._held.size){const t=s.textContent.slice(1,-1);this.bind=t||"none",this._listening=!1,this._updateStyle(s),e.emit("module.call",{name:this.text,bind:this.bind,call:!1})}}),t.appendChild(s)}return t.appendChild(n),t.appendChild(s),this._buildInto(t),this}_updateStyle(e){this._listening?(e.textContent="[...]",e.style.color="#1967d2"):(e.textContent=`[${this.bind}]`,e.style.color="#999")}_getHeldKeys(e){const t=[];e.ctrlKey&&t.push("CTRL"),e.shiftKey&&t.push("SHFT"),e.altKey&&t.push("ALT"),e.metaKey&&t.push("META");const n=this._normalizeKey(e.key);return["control","shift","alt","meta"].includes(e.key.toLowerCase())||t.push(n),t.join(" + ")}_normalizeKey(e){const t={Control:"CTRL",Shift:"SHFT",Alt:"ALT",Meta:"META"};return t[e]?t[e]:1===e.length?e.toUpperCase():e}}class m extends h{constructor(){super()}build(){const e=document.createElement("div");return Object.assign(e.style,{height:"1px",background:"#2a2a2a",margin:"15px 0"}),this._buildInto(e),this}}class b extends h{constructor(){super(),this.text="text",this.info="",this.item="",this.items=[]}setText(e){return this.text=e,this}setInfo(e){return this.info=e,this}setItem(e){return this.item=e,this}setItems(e){return this.items=e,this}build(){const t=document.createElement("div");Object.assign(t.style,{marginBottom:"10px"});const n=document.createElement("div");Object.assign(n.style,{padding:"12px",background:"#0f0f0f",border:"1px solid #2a2a2a",cursor:"pointer",userSelect:"none"});const s=document.createElement("div");s.textContent=this.text,Object.assign(s.style,{color:"#ddd",fontSize:"13px",marginBottom:"8px"});const i=document.createElement("div");Object.assign(i.style,{width:"100%",padding:"8px",background:"#2a2a2a",color:"#ddd",border:"1px solid #333",fontSize:"13px",cursor:"pointer",outline:"none",position:"relative",userSelect:"none"}),this.item=this.item||this.items[0]||"";const o=document.createElement("span");o.textContent=this.item;const a=document.createElement("div");Object.assign(a.style,{position:"absolute",top:"100%",left:"-1px",right:"-1px",background:"#2a2a2a",border:"1px solid #333",borderTop:"none",maxHeight:"200px",overflowY:"auto",display:"none",zIndex:"1000",marginTop:"0"}),this.items.forEach(t=>{const n=document.createElement("div");n.textContent=t,Object.assign(n.style,{padding:"8px",cursor:"pointer",color:"#ddd",fontSize:"13px"}),n.addEventListener("mouseenter",()=>{n.style.background="#1967d2"}),n.addEventListener("mouseleave",()=>{n.style.background="transparent"}),n.addEventListener("click",n=>{n.stopPropagation(),this.item=t,o.textContent=t,a.style.display="none",e.emit("module.change",{name:this.text,val:t})}),a.appendChild(n)}),i.addEventListener("click",e=>{e.stopPropagation();const t="block"===a.style.display;a.style.display=t?"none":"block"}),document.addEventListener("click",()=>{a.style.display="none"});const d=document.createElement("div");d.textContent=this.info,Object.assign(d.style,{padding:"12px",background:"#0a0a0a",border:"1px solid #2a2a2a",borderTop:"none",color:"#999",fontSize:"12px",lineHeight:"1.5",display:"none"});let r=!1;return n.addEventListener("contextmenu",e=>{e.preventDefault(),r=!r,d.style.display=r?"block":"none",n.style.background=r?"#151515":"#0f0f0f"}),i.appendChild(a),i.appendChild(o),n.appendChild(s),n.appendChild(i),t.appendChild(n),t.appendChild(d),this._buildInto(t),this}}class g extends h{constructor(){super(),this.text="text",this.info="",this.min=0,this.max=0,this.val=0}setText(e){return this.text=e,this}setMin(e){return this.min=e,this}setMax(e){return this.max=e,this}setVal(e){return this.val=e,this}setInfo(e){return this.info=e,this}build(){const t=document.createElement("div");Object.assign(t.style,{marginBottom:"10px"});const n=document.createElement("div");Object.assign(n.style,{padding:"12px",background:"#0f0f0f",border:"1px solid #2a2a2a",cursor:"pointer",userSelect:"none"});const s=document.createElement("div");Object.assign(s.style,{display:"flex",justifyContent:"space-between",marginBottom:"8px",alignItems:"center"});const i=document.createElement("span");i.textContent=this.text,Object.assign(i.style,{color:"#ddd",fontSize:"13px"});const o=document.createElement("input");Object.assign(o,{type:"text",value:this.val}),Object.assign(o.style,{color:"#1967d2",fontSize:"13px",background:"transparent",border:"none",padding:"0",width:"80px",textAlign:"right",outline:"none"});const a=document.createElement("input");Object.assign(a,{type:"range",min:this.min,max:this.max,value:this.val}),Object.assign(a.style,{width:"100%",height:"4px",background:"#2a2a2a",outline:"none"});const d=document.createElement("div");d.textContent=this.info,Object.assign(d.style,{padding:"12px",background:"#0a0a0a",border:"1px solid #2a2a2a",borderTop:"none",color:"#999",fontSize:"12px",lineHeight:"1.5",display:"none"}),o.addEventListener("input",t=>{const n=parseInt(t.target.value)||0,s=Math.max(this._min,Math.min(this._max,n));a.value=s,o.value=n,e.emit("module.change",{name:this.text,val:n})}),o.addEventListener("keypress",e=>{/[\d.\-]/.test(e.key)||e.preventDefault()}),a.addEventListener("input",t=>{o.value=t.target.value,e.emit("module.change",{name:this.text,val:parseInt(t.target.value)})});let r=!1;return n.addEventListener("contextmenu",e=>{e.preventDefault(),r=!r,d.style.display=r?"block":"none",n.style.background=r?"#151515":"#0f0f0f"}),s.appendChild(i),s.appendChild(o),n.appendChild(s),n.appendChild(a),t.appendChild(n),t.appendChild(d),this._buildInto(t),this}}class f extends h{constructor(){super(),this.text="text",this.info="",this.state=!1}setText(e){return this.text=e,this}setState(e){return this.state=e,this}setInfo(e){return this.info=e,this}build(){const t=document.createElement("div");Object.assign(t.style,{marginBottom:"10px"});const n=document.createElement("div");Object.assign(n.style,{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",background:"#0f0f0f",border:"1px solid #2a2a2a",cursor:"pointer",userSelect:"none"});const s=document.createElement("span");s.textContent=this.text,Object.assign(s.style,{color:"#ddd",fontSize:"13px"});let i=this.state;const o=document.createElement("div");Object.assign(o.style,{width:"40px",height:"20px",background:i?"#1967d2":"#2a2a2a",position:"relative",transition:"background 0.3s"});const a=document.createElement("div");Object.assign(a.style,{width:"16px",height:"16px",background:"white",position:"absolute",top:"2px",left:i?"22px":"2px",transition:"left 0.3s",pointerEvents:"none"});const d=document.createElement("div");d.textContent=this.info,Object.assign(d.style,{padding:"12px",background:"#0a0a0a",border:"1px solid #2a2a2a",borderTop:"none",color:"#999",fontSize:"12px",lineHeight:"1.5",display:"none"}),n.addEventListener("click",t=>{0===t.button&&(i=!i,e.emit("module.toggle",{name:this.text,state:i}),o.style.background=i?"#1967d2":"#2a2a2a",a.style.left=i?"22px":"2px")});let r=!1;return n.addEventListener("contextmenu",e=>{e.preventDefault(),r=!r,d.style.display=r?"block":"none",n.style.background=r?"#151515":"#0f0f0f"}),o.appendChild(a),n.appendChild(s),n.appendChild(o),t.appendChild(n),t.appendChild(d),this._buildInto(t),this}}const x=JSON.parse('{"0":"ðŸ¢","1":"ðŸ£","2":"ðŸ¤","3":"ðŸ¥","4":"ðŸ¦","5":"ðŸ§","6":"ðŸ¨","7":"ðŸ©","8":"ðŸª","9":"ðŸ«","a":"Ð°","b":"b","c":"Ñ","d":"Ô","e":"Ðµ","f":"f","g":"É¡","h":"Ò»","i":"Ñ–","j":"Ñ˜","k":"k","l":"|","m":"m","n":"Õ¸","o":"Ð¾","p":"Ñ€","q":"Õ¦","r":"Ð³","s":"êœ±","t":"t","u":"Õ½","v":"á´ ","w":"Ô","x":"Ò³","y":"Ñƒ","z":"Ê","A":"Î‘","B":"á´","C":"Ð¡","D":"áŽ ","E":"Î•","F":"ðŠ‡","G":"ê“–","H":"ê“§","I":"|","J":"J","K":"ê“—","L":"L","M":"ê“Ÿ","N":"ê“ ","O":"O","P":"ê“‘","Q":"ï¼±","R":"ê“£","S":"Ð…","T":"Ð¢","U":"ï¼µ","V":"ê“¦","W":"ê“ª","X":"ê“«","Y":"Ò®","Z":"ê“œ"}'),y={saved:[],index:-1,focused:!1,input:$("#content"),listener:[]},v={saved:[],index:-1,focused:!1,input:$("#message_content"),listener:[]},k=e=>{const t=Object.fromEntries(Object.entries(x).map(([e,t])=>[t,e]));return e.normalize("NFC").replaceAll("â€","").split("").map(e=>t[e]??e).join("")},w=(e,t)=>{const n=new URLSearchParams(e);if(!n.has("content"))return;const s=n.get("content");for(let e=t.saved.length-1;e>=0;e--)k(t.saved[e])===k(s)&&t.saved.splice(e,1);t.saved.push(k(s)),t.saved.length>35&&(t.saved=t.saved.slice(-35)),c.update("chat_save",{main:y.saved,priv:v.saved})},E=e=>{const t=()=>{e.focused=!0,e.index=e.saved.length},n=()=>{e.focused=!1,e.index=e.saved.length},s=t=>{e.focused&&0!==e.saved.length&&("ArrowUp"===t.key?(t.preventDefault(),e.index--,e.index<0&&(e.index=e.saved.length-1),e.input.val(e.saved[e.index])):"ArrowDown"===t.key&&(t.preventDefault(),e.index++,e.index>=e.saved.length&&(e.index=0),e.input.val(e.saved[e.index])))};e.input.on("focus",t),e.input.on("blur",n),e.input.on("keydown",s),e.listener.push({event:"focus",func:t},{event:"blur",func:n},{event:"keydown",func:s})},_={init(){const e=c.get();e&&e.chat_save&&(y.saved=e.chat_save.main,v.saved=e.chat_save.priv),l.onXHR.push(function(e){const t=e[0];"string"==typeof t&&(this._main&&(console.log("main",this),w(t,y)),this._priv&&(console.log("priv",this),w(t,v)))}),E(y),E(v)},deinit(){[y,v].forEach(e=>{e.listener.forEach(({event:t,func:n})=>{e.input.off(t,n)}),e.listener=[],e.focused=!1,e.index=-1})}};class C{constructor(e={}){const{text:t="",tab:n="",side:s="",type:i="",info:o="",config:a={}}=e;this.text=t,this.tab=n,this.side=s,this.type=i,this.info=o,this.config=a,this.state=!1}onInit(){}onEnable(){}onDisable(){}onChange(e){}enable(){this.state=!0,this.onEnable()}disable(){this.state=!1,this.onDisable()}toggle(e){e?this.enable():this.disable()}}const O="No width space",S="Character look-alike";let j=S;class L extends C{constructor(){super({text:"Filter bypass",tab:d.Modules,side:a.Left,type:o,info:"Attemps to bypass the chat filter."}),this._lookalikes={}}onInit(){this._lookalikes=x;const e=this;l.onXHR.push(function(t){const n=t[0];if(!this._hook||!e.state)return;const s=new URLSearchParams(n);if(!s.has("content"))return;const i=s.get("content");let o="";o=j===O?i.split(" ").map(e=>e.length<=2?e:e.split("").join("â€")).join(" "):i.split("").map(t=>e._lookalikes[t]??t).join(""),s.set("content",o),t[0]=s.toString()})}}class T extends C{constructor(){super({text:"Bypass mode",tab:d.Modules,side:a.Left,type:s,info:"The method to use to bypass the message.",config:{items:[S,O]}})}onChange(e){j=e}}const R={canRunBind:()=>""!==window.$("#message_content").val()?(window.$("#message_content").focus(),!1):!window.$("#set_user_about").is(":focus")||(window.$("#set_user_about").focus(),!1)};class I extends C{constructor(){super({text:"Block this person",tab:d.Modules,side:a.Right,type:n,info:"Blocks the current person you are talking to."})}onEnable(){if(!R.canRunBind())return;if(0===window.currentPrivate)return;window.ignoreThisUser();const e=$("#private_close")[0];e&&e.click()}}class M extends C{constructor(){super({text:"Whitelist Friends",tab:d.Modules,side:a.Right,type:o,info:'Prevents the "block this person" (fast block) module from blocking friends.'})}}const z=JSON.parse('{"Z":["ZCBpc2NvcmQ=","dGVsZWdt","Y3A=","dGVsZWdyYW0=","dGVsZ3JhbQ==","dGxlZw==","cyBlIHMgcyBpIG8gbg==","dGVsZWdybQ=="]}');class H extends C{constructor(){super({text:"Spam filter",tab:d.Modules,side:a.Left,type:o,info:"Attemps to detect and remove messages sent by spam bots."}),this._watcher=null,this._list=[],this._debug=!1}onInit(){z.Z.forEach(e=>{const t=atob(e);this._list.includes(t)||this._list.push(t)})}onEnable(){this._watcher=new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{e instanceof HTMLElement&&e.querySelectorAll(".chat_message").forEach(e=>{const t=e.innerText.toLowerCase().replace(/[^a-z0-9 ]/g,""),n=this._list.find(e=>t.includes(e.toLowerCase()));if(!n)return;const s=e.closest(".public__message");if(s&&(s.remove(),this._debug)){const e=s.querySelector(".cdate").innerText.trim(),i=s.querySelector(".username").innerText.trim(),o=s.querySelector(".avtrig.avs_menu.chat_avatar").getAttribute("data-id");console.log(`[${e}] removed: ${i} (${o}) - ${t} for "${n}"`)}})})})}),this._watcher.observe($("#chat_logs_container")[0],{childList:!0,subtree:!0})}onDisable(){this._watcher&&(this._watcher.disconnect(),this._watcher=null)}}class B extends C{constructor(){super({text:"Swap private messages",tab:d.Modules,side:a.Right,type:n,info:"Quickly open an unread private message."})}onEnable(){R.canRunBind()&&(window.hideMenu("private_menu"),window.$.post("system/float/private_notify.php",{},e=>{window.appendMenu("private_menu",e);const t=$(".priv_mess")[0];if(!t)return;const n=t.querySelector(".fmenu_name.gprivate");n&&(n.click(),$("#message_content").focus())}))}}const A={hookCloseToReload(){let e=window.closeRight;window.closeRight=()=>{window.prepareRight(0),window.userReload(1),window.closeRight=e,e=null}}};class X extends C{constructor(){super({text:"Search users by country",tab:d.Modules,side:a.Right,type:n,info:"Lets you search for people in a specific country."})}onEnable(){const e=prompt('Country code to search, example: "sg" for Singapore.');e&&(window.prepareRight(0),$.post("system/panel/user_list.php",{},function(t){$("#chat_right_data").html(t),window.firstPanel="",document.querySelectorAll("#chat_right_data .user_item").forEach(t=>{t.getAttribute("data-country")!==e.toUpperCase()&&t.remove()}),A.hookCloseToReload()}))}}class D extends C{constructor(){super({text:"Clear private messages",tab:d.Modules,side:a.Right,type:n,info:"Deletes everyone from the private message list."})}onEnable(){window.privateClear()}}class N extends C{constructor(){super({text:"Blur background",tab:d.Modules,side:a.Right,type:o,info:"Blurs the background when you open someones profile instead of turning the screen black."})}onEnable(){$("#large_modal").css("backdrop-filter","blur(8px)")}onDisable(){$("#large_modal").css("backdrop-filter","blur(0px)")}}class W extends C{constructor(){super({text:"Background opacity",tab:d.Modules,side:a.Right,type:i,info:"The opacity of the background when you click on someones profile.",config:{min:0,max:100,val:50}})}onChange(e){$("#large_modal").css("background-color",`rgb(0, 0, 0, ${e/100})`)}}class q extends C{constructor(){super({text:"Notifications",tab:d.Settings,side:a.Left,type:o,info:"Whether notifications should be sent.",config:{state:!0}})}onEnable(){r.notifsAllowed=!0}onDisable(){r.notifsAllowed=!1}}const K={sections:{},modules:{},add(e){this.modules[e.text]=e,this.ui(e)},register(){this.add(new L),this.add(new T),(new m).setTab(d.Modules).setSide(a.Left).build(),this.add(new H),this.add(new B),this.add(new D),this.add(new X),this.add(new I),this.add(new M),(new m).setTab(d.Modules).setSide(a.Right).build(),this.add(new N),this.add(new W),(new m).setTab(d.Modules).setSide(a.Right).build(),this.add(new q)},load(e){const t=c.get();if(!t||!t.modules)return null;for(const[n,s]of Object.entries(t.modules))if(this.modules[n]&&n===e)return Object.values(s)[0]},save(e,t){const n=(c.get()||{}).modules||{};n[e]=t,c.update("modules",n)},ui(e){const a=this.load(e.text);switch(e.type){case t:(new p).setTab(e.tab).setSide(e.side).setText(e.text).setGhost(e.config.placeholder).setVal(a||e.config.val).setInfo(e.info).build(),this.modules[e.text].onChange(a);break;case n:(new u).setTab(e.tab).setSide(e.side).setText(e.text).setBinded(!0).setBind(a||e.config.bind).setInfo(e.info).build();break;case s:(new b).setTab(e.tab).setSide(e.side).setText(e.text).setItems(e.config.items).setItem(a||e.config.item).setInfo(e.info).build(),this.modules[e.text].onChange(a);break;case i:(new g).setTab(e.tab).setSide(e.side).setText(e.text).setMin(e.config.min).setMax(e.config.max).setVal(a||e.config.val).setInfo(e.info).build(),this.modules[e.text].onChange(a);break;case o:(new f).setTab(e.tab).setSide(e.side).setText(e.text).setState(a||e.config.state).setInfo(e.info).build(),this.modules[e.text].toggle(a)}e.onInit()},init(){l.hookXHR(),_.init(),this.register(),e.on("module.toggle",e=>{for(const t in this.modules)t===e.name&&(this.save(t,{state:e.state}),this.modules[t].toggle(e.state))}),e.on("module.change",e=>{for(const t in this.modules)t===e.name&&(this.save(t,{val:e.val}),this.modules[t].onChange(e.val))}),e.on("module.call",e=>{for(const t in this.modules)t===e.name&&(this.save(t,{bind:e.bind}),e.call&&this.modules[t].onEnable())}),r.sendNotif("Better Chat Avenue loaded!",5),r.sendNotif('Click the "Insert" key to toggle the UI.',7)},deinit(){Object.values(this.modules).forEach(e=>{e.disable()}),_.deinit(),l.unhookXHR()}};if(void 0!==window.bca&&0!==Object.keys(window.bca).length)throw new Error("better chat ave is already running");window.bca={},window.bca.utils={},window.bca.artifacts=[],r.createMain("Better Chat Avenue - femrawr"),K.init(),e.on("exit",()=>{window.bca.artifacts.forEach(e=>{e.remove()}),K.deinit()})})();